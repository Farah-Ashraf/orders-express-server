import { conn } from "../../../../db/connection.js";

//addproduct
export const addproduct = (req,res,next) => {

    const {productName, category, unitPrice} = req.body;

    let query = "INSERT INTO product (productName,category,unitPrice) VALUES (?,?,?)";
    conn.execute(query, [productName, category, unitPrice], (err, result) => {
        if(err){
            return res.status(500).json({ message: err.message, success: false });
        }

        return res.status(201).json({message:"Product added successfully" , success: true});
    })
    

}

//API to find the total revenue generated by each category of products.
export const productTotalRevenue = (req,res,next) => {


    let query = `SELECT p.category, COALESCE(SUM(oi.quantity*oi.unitPrice), 0) AS Total_revenue
    FROM product p
    LEFT JOIN orderitem oi on p.id = oi.productId
    LEFT JOIN orders o on oi.orderId = o.id
    GROUP BY p.category`;
    conn.execute(query, (err, result) => {
        if(err){
            return res.status(500).json({ message: err.message, success: false });
        }
        if (!result.length) {
            return res.status(404).json({ message: 'No data found', success: false });
        }

        return res.status(200).json(result);
    })
    

}

//API to find the total number of items sold for each product.
export const noOfItemsSold = (req,res,next) => {

    let query = `SELECT p.id, p.productName, p.category, SUM(oi.quantity) AS Total_Items_Sold
    FROM product p
    JOIN orderitem oi on p.id = oi.productId 
    GROUP BY p.id, p.productName, p.category`;
    conn.execute(query, (err, result) => {
        if(err){
            return res.status(500).json({ message: err.message, success: false });
        }
        if (!result.length) {
            return res.status(404).json({ message: 'No data found', success: false });
        }

        return res.status(200).json(result);
    })
    

}



